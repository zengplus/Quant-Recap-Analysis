# AlphaGPT 实验文档 V0.3

> **版本**: V0.3  
> **日期**: 2026-02-16  
> **核心任务**: 在“三段时间（train/valid/holdout）+ 牛熊规则”的验收口径下，把多 seed 通过率提升到 ≥70%，并降低 final_select/rerank 的随机性

V0.3 的主线不是继续“调 reward”，而是把提升通过率的杠杆放在 **候选生成预算** 与 **多阶段筛选（gate → 严格回测确认）** 上：在不改变验收口径的前提下，用更稳定、更可复现的方式把“可行解”从稀疏搜索空间里捞出来。

---

## 1. V0.3 的关键变化（相较 V0.2）

### 1.1 把通过率问题从“训练不够好”转为“筛选不够稳”

在 V0.2 的新切分体系（2014-2019 / 2020-2022 / 2023-2024 + 2025 压测）与牛熊规则下，观测到：
- 可行解存在，但对 seed 高敏感；
- 失败主要集中在某一段（尤其是 holdout 或 train），且经常是“边界上轻微不满足规则”。

因此 V0.3 的核心策略是：在训练输出的基础上，通过扩大候选多样性与 gate 化筛选，显著提升“找到可行解”的概率，并让挑选过程可复现。

### 1.2 final_select 预算提升 + 多样性更强

final_select 的候选来源分为两部分：
- 本地扰动（local perturbation）
- 模型采样（model sampling）

V0.3 提升了候选预算，并强化本地扰动操作（替换/插入/删除 token），从而提升候选覆盖度，降低“运气挑中”的依赖。

### 1.3 rerank 从“随机抽样”改为“两阶段、确定性筛选”

V0.3 将 rerank 拆为两层：
1. **快速 gate（近似评估）**：对 train/valid/holdout 做 bull/bear 规则的 margin 计算，优先保留“段内 margin 更安全”的候选；
2. **严格确认（主裁判）**：对少量候选再跑 joinquant_like 回测做最终确认，保证验收口径与最终输出一致。

同时，多样性补充从 `random.sample` 改为“均匀取样”（同 seed 可复现），降低随机性波动。

---

## 2. 复现方式（V0.3）

### 2.1 复现：rerank-only（不重新训练，只改筛选）

从已有 run 目录读取权重与中间产物，只重做 final_select/rerank：
- 参考结果：`outputs/v3/v3_20260216_140831`（6/6 通过）

入口函数见：`run_pipeline.run_v3_protocol_rerank_only()`

### 2.2 复现：重新随机 6 个 seed 训练

直接用 `run_pipeline.run_v3_protocol()` 跑一轮新 seed 训练：
- 参考结果：`outputs/v3/v3_20260216_160745`（5/6 通过）

---

## 3. 结果快照（本次记录）

### 3.1 rerank-only：6/6 通过

- 记录文件：`outputs/v3/v3_20260216_140831/v3_record.json`
- 源 run：`outputs/v3/v3_20260215_204626`

### 3.2 新随机 seed 训练：5/6 通过（83.33%）

- 记录文件：`outputs/v3/v3_20260216_160745/v3_record.json`

